(()=>{"use strict";var e={617:(e,t,n)=>{const r=require("mongoose");var o=n.n(r);o().connect(process.env.DATABASE_URL,{useUnifiedTopology:!0,useNewUrlParser:!0}).catch((function(e){throw new Error(e.message)})).then((function(){console.log("connected to db")}));const i=require("path");var u=n.n(i);const c=require("express");var a=n.n(c);const s=require("cookie-session");var f=n.n(s);const l=require("passport");var p=n.n(l);const y=require("body-parser");var b=n.n(y);const d=require("serve-favicon");var v=n.n(d);const h=require("cors");var m=n.n(h);const g=require("joi");var w=n.n(g),O=new(o().Schema)({title:{type:String,minlength:3,maxlength:30,required:!0,trim:!0},numberInStock:{type:Number,min:0,max:255,required:!0},image:String});function x(e){return w().object({title:w().string().min(3).max(255).required(),numberInStock:w().number().min(0).max(255).required(),image:w().string()}).validate(e)}var R=o().model("Book",O);const S=require("multer");var _=n.n(S);const j=require("crypto");function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?E(e):t}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e){var t="function"==typeof Map?new Map:void 0;return(I=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return q(e,arguments,D(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),C(r,e)})(e)}function q(e,t,n){return(q=T()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&C(o,n.prototype),o}).apply(null,arguments)}function T(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var L=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(o,e);var t,n,r=(t=o,n=T(),function(){var e,r=D(t);if(n){var o=D(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return P(this,e)});function o(e){var t,n,i,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),u=void 0,(i="statusCode")in(n=E(t=r.call(this,e)))?Object.defineProperty(n,i,{value:u,enumerable:!0,configurable:!0,writable:!0}):n[i]=u,Object.setPrototypeOf(E(t),o.prototype),t}return o}(I(Error));function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function G(e,t){return(G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function B(e,t){return!t||"object"!==A(t)&&"function"!=typeof t?z(e):t}function z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var N=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&G(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=M(r);if(o){var n=M(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return B(this,e)});function u(e){var t,n,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e)).message=e,400,(r="statusCode")in(n=z(t))?Object.defineProperty(n,r,{value:400,enumerable:!0,configurable:!0,writable:!0}):n[r]=400,Object.setPrototypeOf(z(t),u.prototype),t}return t=u,(n=[{key:"serializeErrors",value:function(){return[{message:this.message}]}}])&&U(t.prototype,n),u}(L);function F(e){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Y(e,t){return(Y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $(e,t){return!t||"object"!==F(t)&&"function"!=typeof t?H(e):t}function H(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var V=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Y(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=J(r);if(o){var n=J(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return $(this,e)});function u(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),Q(H(e=i.call(this,"Error connecting to databaase")),"statusCode",500),Q(H(e),"reason","Error connecting to database"),Object.setPrototypeOf(H(e),u.prototype),e}return t=u,(n=[{key:"serializeErrors",value:function(){return[{message:this.reason}]}}])&&K(t.prototype,n),u}(L);function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function X(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e,t){return(Z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ee(e,t){return!t||"object"!==W(t)&&"function"!=typeof t?te(e):t}function te(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ne(e){return(ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var re=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Z(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ne(r);if(o){var n=ne(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ee(this,e)});function u(e){var t,n,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,"Invalid request parameters")).message=e,400,(r="statusCode")in(n=te(t))?Object.defineProperty(n,r,{value:400,enumerable:!0,configurable:!0,writable:!0}):n[r]=400,Object.setPrototypeOf(te(t),u.prototype),t}return t=u,(n=[{key:"serializeErrors",value:function(){return[{message:this.message}]}}])&&X(t.prototype,n),u}(L);function oe(e,t,n,r,o,i,u){try{var c=e[i](u),a=c.value}catch(e){return void n(e)}c.done?t(a):Promise.resolve(a).then(r,o)}var ie=function(e){return function(){var t,n=(t=regeneratorRuntime.mark((function t(n,r,o){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e(n,r);case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),o(t.t0);case 8:case"end":return t.stop()}}),t,null,[[0,5]])})),function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function u(e){oe(i,r,o,u,c,"next",e)}function c(e){oe(i,r,o,u,c,"throw",e)}u(void 0)}))});return function(e,t,r){return n.apply(this,arguments)}}()};function ue(e,t,n,r,o,i,u){try{var c=e[i](u),a=c.value}catch(e){return void n(e)}c.done?t(a):Promise.resolve(a).then(r,o)}function ce(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){ue(i,r,o,u,c,"next",e)}function c(e){ue(i,r,o,u,c,"throw",e)}u(void 0)}))}}var ae=_().diskStorage({destination:function(e){function t(t,n,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,n){n(null,"images")})),filename:function(e,t,n){n(null,(0,j.randomBytes)(4).toString("hex")+"-"+t.originalname)}}),se=_()({fileFilter:function(e,t,n){if(!t.originalname.match(/\.(jpg|jpeg|png|gif)$/))return n(null,!1);n(null,!0)},storage:ae,limits:{fileSize:5242880}});const fe=require("winston-mongodb");var le=n.n(fe);const pe=require("winston");var ye=n.n(pe),be=ye().createLogger({level:"info",format:ye().format.json(),defaultMeta:{service:"user-service"},transports:[new(ye().transports.File)({filename:"error.log",level:"error"}),new(le().MongoDB)({db:process.env.DATABASE_URL})]});const de=require("passport-google-oauth20");var ve=n.n(de),he=new(0,o().Schema)({googleId:{type:String,required:!0}}),me=o().model("User",he);function ge(e,t,n,r,o,i,u){try{var c=e[i](u),a=c.value}catch(e){return void n(e)}c.done?t(a):Promise.resolve(a).then(r,o)}function we(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){ge(i,r,o,u,c,"next",e)}function c(e){ge(i,r,o,u,c,"throw",e)}u(void 0)}))}}p().serializeUser((function(e,t){t(null,e.id)})),p().deserializeUser(function(){var e=we(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,me.findById(t);case 2:(r=e.sent)&&n(null,r);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),p().use(new(ve().Strategy)({clientID:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,callbackURL:"http://localhost:4500/auth/google/callback",proxy:!0},function(){var e=we(regeneratorRuntime.mark((function e(t,n,r,o){var i,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,me.findOne({googleId:r.id});case 2:return(i=e.sent)&&o(void 0,i),e.next=6,new me({googleId:r.id}).save();case 6:u=e.sent,o(void 0,u);case 8:case"end":return e.stop()}}),e)})));return function(t,n,r,o){return e.apply(this,arguments)}}()));var Oe=a()();Oe.use(b().json()),Oe.use(b().urlencoded({extended:!0})),Oe.use(a().static("public")),Oe.use("/favicon.ico",v()(u().join(__dirname,"..","public","favicon.ico"))),Oe.use(m()()),Oe.use(f()({maxAge:2592e6,keys:[process.env.COOKIE_KEY]})),Oe.use(p().initialize()),Oe.use(p().session()),function(e){e.get("/auth/google",p().authenticate("google",{scope:["profile","email"]})),e.get("/auth/google/callback",p().authenticate("google"),(function(e,t){t.redirect("/")})),e.get("/auth/current_user",(function(e,t){t.send(e.user)})),e.get("/auth/logout",(function(e,t){e.logout(),t.json({user:e.user})}))}(Oe),function(e){e.get("/api/books",ie(function(){var e=ce(regeneratorRuntime.mark((function e(t,n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.find().sort("");case 2:if(o=e.sent){e.next=5;break}throw new V;case 5:n.send(o);case 6:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}())),e.get("/api/books/:id",ie(function(){var e=ce(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.findById(t.params.id);case 2:if(!(r=e.sent)){e.next=5;break}throw new N("Invalid Id");case 5:n.send(r);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())),e.post("/api/books",se.single("bookImage"),ie(function(){var e=ce(regeneratorRuntime.mark((function e(t,n){var r,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t.file),console.log("req.body",t.body),r=x(t.body),!(o=r.error)){e.next=5;break}throw new re(o.details[0].message);case 5:return i=new R({title:t.body.title,numberInStock:t.body.numberInStock,image:t.file}),e.next=8,i.save();case 8:i=e.sent,n.send(i);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())),e.put("/api/books/:id",ie(function(){var e=ce(regeneratorRuntime.mark((function e(t,n){var r,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=x(t.body),!(o=r.error)){e.next=3;break}throw new re(o.details[0].message);case 3:return e.next=5,R.findByIdAndUpdate(t.params.id,{title:t.body.title,numberInStock:t.body.numberInStock,dailyRentalRate:t.body.dailyRentalRate},{new:!0});case 5:if(i=e.sent){e.next=8;break}throw new V;case 8:return e.next=10,i.save();case 10:i=e.sent,n.send(i);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())),e.delete("/api/books/:id",ie(function(){var e=ce(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.params.id){e.next=7;break}return e.next=3,R.findOneAndDelete({_id:t.params.id});case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return",n.status(400).send("not found"));case 6:n.send(r);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()))}(Oe),Oe.get("/",(function(e,t){t.send("\n    \n".concat('  <html>\n  <head>\n    <link rel="stylesheet" href="/styles.css">\n  </head>\n  <header> \n  <div class="header">\n  <ul>\n  <li> <a href="/auth/current_user">Current User</a> </li>\n   <li><a href="https://github.com/yilmazbingo/typescript-node-google-oauth" target="_blank"> \n      <img height="32" width="32" src="https://cdn.jsdelivr.net/npm/simple-icons@v4/icons/github.svg" /> </a>\n   </li>\n  <li> <a href="/auth/logout">Logout</a> </li>\n  </ul>\n  </div>\n  </header>\n  <body>\n    <section>\n    <div>\n    <h2>My Course Goal</h2>\n      <p>This api is set for </p>\n    </div>\n      \n    </section>\n      <section >\n      <a href="/auth/google">      <button >Google-Oauth-Authentication</button>\n      </a>\n      </section>\n      \n  </body>\n</html>',"\n     \n  "))})),Oe.use((function(e,t,n,r){be.error(e),n.json({status:"Error",statusCode:e.statusCode,message:e.message})})),Oe.listen(process.env.PORT,(function(){console.log("listenint at ".concat(process.env.PORT," "))})),process.env.GOOGLE_CLIENT_ID&&process.env.GOOGLE_CLIENT_SECRET&&process.env.DATABASE_URL&&process.env.COOKIE_KEY||(console.log("check your env variables"),process.exit(1))},835:e=>{e.exports=require("regenerator-runtime/runtime")}},t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n(835),n(617)})();