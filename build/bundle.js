(()=>{"use strict";var e={692:(e,t,n)=>{const r=require("mongoose");var o=n.n(r);o().connect(process.env.DATABASE_URL,{useUnifiedTopology:!0,useNewUrlParser:!0}).catch((function(e){throw new Error(e.message)})).then((function(){console.log("connected to db")}));const i=require("express");var u=n.n(i);const c=require("cookie-session");var a=n.n(c);const s=require("passport");var f=n.n(s);const l=require("body-parser");var p=n.n(l);const y=require("cors");var b=n.n(y);const d=require("joi");var h=n.n(d),v=new(o().Schema)({title:{type:String,minlength:3,maxlength:30,required:!0,trim:!0},numberInStock:{type:Number,min:0,max:255,required:!0},image:String});function m(e){return h().object({title:h().string().min(3).max(255).required(),numberInStock:h().number().min(0).max(255).required(),image:h().string()}).validate(e)}var g=o().model("Book",v);const w=require("multer");var O=n.n(w);const x=require("crypto");function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){return!t||"object"!==R(t)&&"function"!=typeof t?_(e):t}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e){var t="function"==typeof Map?new Map:void 0;return(j=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return k(e,arguments,I(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),E(r,e)})(e)}function k(e,t,n){return(k=P()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&E(o,n.prototype),o}).apply(null,arguments)}function P(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(o,e);var t,n,r=(t=o,n=P(),function(){var e,r=I(t);if(n){var o=I(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return S(this,e)});function o(e){var t,n,i,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),u=void 0,(i="statusCode")in(n=_(t=r.call(this,e)))?Object.defineProperty(n,i,{value:u,enumerable:!0,configurable:!0,writable:!0}):n[i]=u,Object.setPrototypeOf(_(t),o.prototype),t}return o}(j(Error));function q(e){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function L(e,t){return!t||"object"!==q(t)&&"function"!=typeof t?A(e):t}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var G=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&D(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=U(r);if(o){var n=U(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return L(this,e)});function u(e){var t,n,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,e)).message=e,400,(r="statusCode")in(n=A(t))?Object.defineProperty(n,r,{value:400,enumerable:!0,configurable:!0,writable:!0}):n[r]=400,Object.setPrototypeOf(A(t),u.prototype),t}return t=u,(n=[{key:"serializeErrors",value:function(){return[{message:this.message}]}}])&&C(t.prototype,n),u}(T);function B(e){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?F(e):t}function F(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function K(e){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=K(r);if(o){var n=K(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return N(this,e)});function u(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),Y(F(e=i.call(this,"Error connecting to databaase")),"statusCode",500),Y(F(e),"reason","Error connecting to database"),Object.setPrototypeOf(F(e),u.prototype),e}return t=u,(n=[{key:"serializeErrors",value:function(){return[{message:this.reason}]}}])&&z(t.prototype,n),u}(T);function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function V(e,t){return!t||"object"!==H(t)&&"function"!=typeof t?W(e):t}function W(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function X(e){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=X(r);if(o){var n=X(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return V(this,e)});function u(e){var t,n,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=i.call(this,"Invalid request parameters")).message=e,400,(r="statusCode")in(n=W(t))?Object.defineProperty(n,r,{value:400,enumerable:!0,configurable:!0,writable:!0}):n[r]=400,Object.setPrototypeOf(W(t),u.prototype),t}return t=u,(n=[{key:"serializeErrors",value:function(){return[{message:this.message}]}}])&&J(t.prototype,n),u}(T);function ee(e,t,n,r,o,i,u){try{var c=e[i](u),a=c.value}catch(e){return void n(e)}c.done?t(a):Promise.resolve(a).then(r,o)}var te=function(e){return function(){var t,n=(t=regeneratorRuntime.mark((function t(n,r,o){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e(n,r);case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),o(t.t0);case 8:case"end":return t.stop()}}),t,null,[[0,5]])})),function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function u(e){ee(i,r,o,u,c,"next",e)}function c(e){ee(i,r,o,u,c,"throw",e)}u(void 0)}))});return function(e,t,r){return n.apply(this,arguments)}}()};function ne(e,t,n,r,o,i,u){try{var c=e[i](u),a=c.value}catch(e){return void n(e)}c.done?t(a):Promise.resolve(a).then(r,o)}function re(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){ne(i,r,o,u,c,"next",e)}function c(e){ne(i,r,o,u,c,"throw",e)}u(void 0)}))}}var oe=O().diskStorage({destination:function(e){function t(t,n,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,n){n(null,"images")})),filename:function(e,t,n){n(null,(0,x.randomBytes)(4).toString("hex")+"-"+t.originalname)}}),ie=O()({fileFilter:function(e,t,n){if(!t.originalname.match(/\.(jpg|jpeg|png|gif)$/))return n(null,!1);n(null,!0)},storage:oe,limits:{fileSize:5242880}});const ue=require("winston-mongodb");var ce=n.n(ue);const ae=require("winston");var se=n.n(ae),fe=se().createLogger({level:"info",format:se().format.json(),defaultMeta:{service:"user-service"},transports:[new(se().transports.File)({filename:"error.log",level:"error"}),new(ce().MongoDB)({db:process.env.DATABASE_URL})]});const le=require("passport-google-oauth20");var pe=n.n(le),ye=new(0,o().Schema)({googleId:{type:String,required:!0}}),be=o().model("User",ye);function de(e,t,n,r,o,i,u){try{var c=e[i](u),a=c.value}catch(e){return void n(e)}c.done?t(a):Promise.resolve(a).then(r,o)}function he(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){de(i,r,o,u,c,"next",e)}function c(e){de(i,r,o,u,c,"throw",e)}u(void 0)}))}}f().serializeUser((function(e,t){t(null,e.id)})),f().deserializeUser(function(){var e=he(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.findById(t);case 2:(r=e.sent)&&n(null,r);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),f().use(new(pe().Strategy)({clientID:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,callbackURL:"https://typescript-google-oauth.herokuapp.com/auth/google/callback",proxy:!0},function(){var e=he(regeneratorRuntime.mark((function e(t,n,r,o){var i,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.findOne({googleId:r.id});case 2:return(i=e.sent)&&o(void 0,i),e.next=6,new be({googleId:r.id}).save();case 6:u=e.sent,o(void 0,u);case 8:case"end":return e.stop()}}),e)})));return function(t,n,r,o){return e.apply(this,arguments)}}()));var ve=u()();ve.use(p().json()),ve.use(p().urlencoded({extended:!0})),ve.use(u().static("public")),ve.use(u().static("build")),ve.use(b()()),ve.use(a()({maxAge:2592e6,keys:[process.env.COOKIE_KEY]})),ve.use(f().initialize()),ve.use(f().session()),ve.get("/",(function(e,t){t.send("\n    \n".concat('  <html>\n  <head>\n    <link rel="stylesheet" href="/styles.css">\n  </head>\n  <header> \n  <div class="header">\n  <ul>\n  <li> <a href="/auth/current_user">Current User</a> </li>\n   <li><a href="https://github.com/yilmazbingo/typescript-node-google-oauth" target="_blank"> \n      <img height="32" width="32" src="https://cdn.jsdelivr.net/npm/simple-icons@v4/icons/github.svg" /> </a>\n   </li>\n  <li> <a href="/auth/logout">Logout</a> </li>\n  </ul>\n  </div>\n  </header>\n  <body>\n    <section>\n    <div>\n    <h2>My Course Goal</h2>\n      <p>This api is set for </p>\n    </div>\n      \n    </section>\n      <section >\n      <a href="/auth/google">      <button >Google-Oauth-Authentication</button>\n      </a>\n      </section>\n      \n  </body>\n</html>',"\n     \n  "))})),function(e){e.get("/auth/google",f().authenticate("google",{scope:["profile","email"]})),e.get("/auth/google/callback",f().authenticate("google"),(function(e,t){t.redirect("/")})),e.get("/auth/current_user",(function(e,t){t.send(e.user)})),e.get("/auth/logout",(function(e,t){e.logout(),t.json({user:e.user})}))}(ve),function(e){e.get("/api/books",te(function(){var e=re(regeneratorRuntime.mark((function e(t,n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.find().sort("");case 2:if(o=e.sent){e.next=5;break}throw new $;case 5:n.send(o);case 6:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}())),e.get("/api/books/:id",te(function(){var e=re(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.findById(t.params.id);case 2:if(!(r=e.sent)){e.next=5;break}throw new G("Invalid Id");case 5:n.send(r);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())),e.post("/api/books",ie.single("bookImage"),te(function(){var e=re(regeneratorRuntime.mark((function e(t,n){var r,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t.file),console.log("req.body",t.body),r=m(t.body),!(o=r.error)){e.next=5;break}throw new Z(o.details[0].message);case 5:return i=new g({title:t.body.title,numberInStock:t.body.numberInStock,image:t.file}),e.next=8,i.save();case 8:i=e.sent,n.send(i);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())),e.put("/api/books/:id",te(function(){var e=re(regeneratorRuntime.mark((function e(t,n){var r,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=m(t.body),!(o=r.error)){e.next=3;break}throw new Z(o.details[0].message);case 3:return e.next=5,g.findByIdAndUpdate(t.params.id,{title:t.body.title,numberInStock:t.body.numberInStock,dailyRentalRate:t.body.dailyRentalRate},{new:!0});case 5:if(i=e.sent){e.next=8;break}throw new $;case 8:return e.next=10,i.save();case 10:i=e.sent,n.send(i);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())),e.delete("/api/books/:id",te(function(){var e=re(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.params.id){e.next=7;break}return e.next=3,g.findOneAndDelete({_id:t.params.id});case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return",n.status(400).send("not found"));case 6:n.send(r);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()))}(ve),ve.use((function(e,t,n,r){fe.error(e),n.json({status:"Error",statusCode:e.statusCode,message:e.message})})),ve.listen(process.env.PORT,(function(){console.log("listenint at ".concat(process.env.PORT," "))})),process.env.GOOGLE_CLIENT_ID&&process.env.GOOGLE_CLIENT_SECRET&&process.env.DATABASE_URL&&process.env.COOKIE_KEY||(console.log("check your env variables"),process.exit(1))},835:e=>{e.exports=require("regenerator-runtime/runtime")}},t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n(835),n(692)})();